<div class="max-w-4xl mx-auto" *ngIf="table$ | async as table">
  <div *ngIf="order$ | async as order">
    <!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº -->
    <div class="mb-6 flex items-center justify-between">
      <div>
        <button
          (click)="goBack()"
          class="text-blue-600 hover:text-blue-700 mb-2 flex items-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          {{ 'orderDetail.back' | translate }}
        </button>
        <h1 class="text-3xl font-bold text-gray-800">
          {{ 'orderDetail.title' | translate }} {{ table.number }}
        </h1>
        <p class="text-gray-600 mt-1">{{ 'orderDetail.orderNumber' | translate }} #{{ order.id }}</p>
      </div>
      <div class="text-right">
        <div class="text-sm text-gray-600">{{ 'orderDetail.waiter' | translate }}</div>
        <div class="text-lg font-semibold">{{ order.waiterName || ('orderDetail.waiterUnknown' | translate) }}</div>
      </div>
    </div>

    <!-- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·Ğ° -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center justify-between">
        <span>{{ 'orderDetail.itemsTitle' | translate }}</span>
        <button
          (click)="addItems()"
          class="text-sm bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          {{ 'orderDetail.addDish' | translate }}
        </button>
      </h2>

      <!-- Ğ•ÑĞ»Ğ¸ Ğ·Ğ°ĞºĞ°Ğ· Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ -->
      <div *ngIf="order.items.length === 0" class="text-center py-12 text-gray-500">
        <div class="text-6xl mb-4">ğŸ½ï¸</div>
        <p class="text-lg mb-4">{{ 'orderDetail.empty.title' | translate }}</p>
        <button
          (click)="addItems()"
          class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition"
        >
          {{ 'orderDetail.empty.button' | translate }}
        </button>
      </div>

      <!-- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ±Ğ»ÑĞ´ -->
      <div *ngIf="order.items.length > 0" class="space-y-3">
        <div
          *ngFor="let item of order.items"
          class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition"
        >
          <!-- Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ±Ğ»ÑĞ´Ğµ -->
          <div class="flex-1">
            <div class="font-semibold text-gray-800">{{ getItemName(item) }}</div>
            <div class="text-sm text-gray-600">{{ formatPrice(item.price) }} Ã— {{ item.quantity }}</div>
            <div *ngIf="item.notes" class="text-xs text-gray-500 mt-1 italic">
              ğŸ’¬ {{ item.notes }}
            </div>
          </div>

          <!-- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾Ğ¼ -->
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 bg-white rounded-lg px-2 py-1 shadow-sm">
              <button
                (click)="updateQuantity(order.id, item.id, -1)"
                class="w-8 h-8 flex items-center justify-center text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition"
              >
                âˆ’
              </button>
              <span class="w-8 text-center font-semibold">{{ item.quantity }}</span>
              <button
                (click)="updateQuantity(order.id, item.id, 1)"
                class="w-8 h-8 flex items-center justify-center text-gray-600 hover:text-green-600 hover:bg-green-50 rounded transition"
              >
                +
              </button>
            </div>

            <!-- Ğ¡ÑƒĞ¼Ğ¼Ğ° -->
            <div class="w-24 text-right font-semibold text-gray-800">
              {{ formatPrice(item.subtotal) }}
            </div>

            <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ -->
            <button
              (click)="removeItem(order.id, item.id)"
              class="w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded transition"
              [title]="'common.delete' | translate"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <div class="flex items-center justify-between mb-6 pb-4 border-b">
        <span class="text-xl font-semibold text-gray-700">{{ 'orderDetail.total' | translate }}</span>
        <span class="text-3xl font-bold text-gray-900">
          {{ formatPrice(order.totalAmount) }}
        </span>
      </div>

      <!-- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ·Ğ°ĞºĞ°Ğ·Ğ° -->
      <div class="mb-4 p-3 bg-blue-50 rounded-lg">
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium text-gray-700">{{ 'orderDetail.status' | translate }}</span>
          <span class="px-3 py-1 rounded-full text-sm font-semibold" 
                [ngClass]="getStatusColor(order.status)">
            {{ getStatusText(order.status) }}
          </span>
        </div>
      </div>

      <div class="flex gap-3">
        <button
          (click)="addItems()"
          class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition font-medium"
        >
          {{ 'orderDetail.addMore' | translate }}
        </button>
        
        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ĞŸĞ¾Ğ´Ğ°Ğ½Ğ¾" (ÑĞ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ñ‹ ÑĞ¾ ÑĞºĞ»Ğ°Ğ´Ğ°) -->
        <button
          *ngIf="order.status === 'in_progress'"
          (click)="markAsServed(order)"
          [disabled]="order.items.length === 0"
          class="flex-1 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition font-medium"
        >
          ğŸ½ï¸ {{ 'orderDetail.markServed' | translate }}
        </button>
        
        <button
          *ngIf="order.status === 'served'"
          (click)="closeOrder(order)"
          class="flex-1 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition font-medium"
        >
          ğŸ’³ {{ 'orderDetail.pay' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Ğ•ÑĞ»Ğ¸ Ğ·Ğ°ĞºĞ°Ğ· Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ -->
  <div *ngIf="!(order$ | async)" class="text-center py-16">
    <div class="text-6xl mb-4">âŒ</div>
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">{{ 'orderDetail.notFound.title' | translate }}</h2>
    <button
      (click)="goBack()"
      class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition"
    >
      {{ 'orderDetail.notFound.button' | translate }}
    </button>
  </div>
</div>

