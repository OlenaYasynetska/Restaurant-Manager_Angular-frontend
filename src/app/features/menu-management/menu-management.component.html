<div class="max-w-7xl mx-auto">
  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-800 mb-2">{{ 'menuManage.title' | translate }}</h1>
      <p class="text-gray-600">{{ 'menuManage.subtitle' | translate }}</p>
    </div>
    <button
      (click)="openCreateModal()"
      class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition font-medium flex items-center gap-2"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      {{ 'menuManage.addDish' | translate }}
    </button>
  </div>

  <!-- Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ -->
  <div class="mb-6 flex gap-2 flex-wrap">
    <button
      (click)="selectedCategory = 'all'"
      [class]="'px-4 py-2 rounded-lg font-medium transition ' + 
        (selectedCategory === 'all' 
          ? 'bg-blue-600 text-white' 
          : 'bg-white text-gray-700 hover:bg-gray-100')"
    >
      {{ 'menu.category.all' | translate }}
    </button>
    <button
      *ngFor="let cat of categories"
      (click)="selectedCategory = cat.value"
      [class]="'px-4 py-2 rounded-lg font-medium transition ' + 
        (selectedCategory === cat.value 
          ? 'bg-blue-600 text-white' 
          : 'bg-white text-gray-700 hover:bg-gray-100')"
    >
      {{ cat.labelKey | translate }}
    </button>
  </div>

  <!-- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ±Ğ»ÑĞ´ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div
      *ngFor="let item of getFilteredItems(menuItems$ | async)"
      class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition"
    >
      <!-- Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ -->
      <div class="h-48 relative overflow-hidden">
        <!-- Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ URL Ñ„Ğ¾Ñ‚Ğ¾ -->
        <img 
          *ngIf="item.imageUrl" 
          [src]="item.imageUrl" 
          [alt]="item.name"
          class="w-full h-full object-cover"
        />
        <!-- Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸ĞºĞ¾Ğ½ĞºÑƒ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ -->
        <div 
          *ngIf="!item.imageUrl" 
          class="w-full h-full bg-gradient-to-br from-orange-100 to-orange-200 flex items-center justify-center"
        >
          <span class="text-6xl">ğŸ½ï¸</span>
        </div>
        
        <div
          *ngIf="!item.available"
          class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded"
        >
          {{ 'menuManage.unavailable' | translate }}
        </div>
      </div>

      <!-- Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ -->
      <div class="p-4">
        <div class="mb-2">
          <span class="text-xs text-gray-500">{{ getCategoryTranslationKey(item.category) | translate }}</span>
        </div>
        <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ getLocalizedName(item) }}</h3>
        <p *ngIf="getLocalizedDescription(item)" class="text-sm text-gray-600 mb-3 line-clamp-2">
          {{ getLocalizedDescription(item) }}
        </p>
        
        <div class="flex items-center justify-between mb-4">
          <div class="text-xl font-bold text-gray-900">{{ formatPrice(item.price) }}</div>
          <div class="text-sm text-gray-500">
            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            {{ item.preparationTime }} {{ 'menu.preparation.minutes' | translate }}
          </div>
        </div>

        <!-- Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ -->
        <div class="flex gap-2">
          <button
            (click)="toggleAvailability(item)"
            [class]="'flex-1 px-3 py-2 rounded-lg transition text-sm font-medium ' +
              (item.available 
                ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200' 
                : 'bg-green-100 text-green-700 hover:bg-green-200')"
          >
            {{ (item.available ? 'menuManage.toggle.disable' : 'menuManage.toggle.enable') | translate }}
          </button>
          <button
            (click)="openEditModal(item)"
            class="flex-1 bg-blue-100 text-blue-700 hover:bg-blue-200 px-3 py-2 rounded-lg transition text-sm font-medium"
          >
            {{ 'menuManage.edit' | translate }}
          </button>
          <button
            (click)="deleteItem(item)"
            class="bg-red-100 text-red-700 hover:bg-red-200 px-3 py-2 rounded-lg transition text-sm font-medium"
          >
            ğŸ—‘ï¸
          </button>
        </div>

        <!-- Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° -->
        <button
          (click)="openRecipeModal(item)"
          [class]="'w-full mt-2 px-3 py-2 rounded-lg transition text-sm font-medium ' +
            (hasRecipe(item.id, recipes$ | async) 
              ? 'bg-green-50 text-green-700 border border-green-300 hover:bg-green-100' 
              : 'bg-purple-50 text-purple-700 border border-purple-300 hover:bg-purple-100')"
        >
          {{ getRecipeIcon(item.id, recipes$ | async) }} {{ getRecipeButtonText(item.id, recipes$ | async) | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ -->
  <div
    *ngIf="showModal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    (click)="closeModal()"
  >
    <div
      class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
      (click)="$event.stopPropagation()"
    >
      <!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº -->
      <div class="border-b px-6 py-4 flex justify-between items-center">
        <h2 class="text-2xl font-bold text-gray-800">
          {{ editingItem ? ('menuManage.modal.editTitle' | translate) : ('menuManage.modal.createTitle' | translate) }}
        </h2>
        <button
          (click)="closeModal()"
          class="text-gray-400 hover:text-gray-600 transition"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Ğ¤Ğ¾Ñ€Ğ¼Ğ° -->
      <form (ngSubmit)="saveItem()" class="p-6">
        <div class="space-y-4">
          <!-- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              {{ 'menuManage.form.name' | translate }} <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              [(ngModel)]="formData.name"
              name="name"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
              [placeholder]="'menuManage.form.namePlaceholder' | translate"
            />
          </div>

          <!-- ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              {{ 'menuManage.form.category' | translate }} <span class="text-red-500">*</span>
            </label>
            <select
              [(ngModel)]="formData.category"
              name="category"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
            >
              <option *ngFor="let cat of categories" [value]="cat.value">
                {{ cat.labelKey | translate }}
              </option>
            </select>
          </div>

          <!-- Ğ¦ĞµĞ½Ğ° Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                {{ 'menuManage.form.price' | translate }} <span class="text-red-500">*</span>
              </label>
              <input
                type="number"
                [(ngModel)]="formData.price"
                name="price"
                required
                min="0"
                step="0.01"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                placeholder="0"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                {{ 'menuManage.form.time' | translate }}
              </label>
              <input
                type="number"
                [(ngModel)]="formData.preparationTime"
                name="preparationTime"
                min="1"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                [placeholder]="'menuManage.form.timePlaceholder' | translate"
              />
            </div>
          </div>

          <!-- ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              {{ 'menuManage.form.description' | translate }}
            </label>
            <textarea
              [(ngModel)]="formData.description"
              name="description"
              rows="3"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none"
              [placeholder]="'menuManage.form.descriptionPlaceholder' | translate"
            ></textarea>
          </div>

          <!-- Ğ¤Ğ¾Ñ‚Ğ¾ Ğ±Ğ»ÑĞ´Ğ° -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              {{ 'menuManage.form.photo' | translate }}
            </label>
            
            <!-- ĞŸÑ€ĞµĞ²ÑŒÑ Ñ„Ğ¾Ñ‚Ğ¾ -->
            <div *ngIf="formData.imageUrl" class="mb-3 relative">
              <img 
                [src]="formData.imageUrl" 
                alt="ĞŸÑ€ĞµĞ²ÑŒÑ" 
                class="w-full h-48 object-cover rounded-lg border-2 border-gray-300"
              />
              <button
                type="button"
                (click)="removePhoto()"
                class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 shadow-lg transition"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>

            <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ -->
            <div class="flex items-center gap-3">
              <label class="flex-1 cursor-pointer">
                <div class="flex items-center justify-center gap-2 px-4 py-3 bg-blue-50 hover:bg-blue-100 border-2 border-blue-300 border-dashed rounded-lg transition text-blue-700 font-medium">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  {{ formData.imageUrl ? ('menuManage.form.photoChange' | translate) : ('menuManage.form.photoUpload' | translate) }}
                </div>
                <input
                  type="file"
                  accept="image/*"
                  (change)="onFileSelected($event)"
                  class="hidden"
                />
              </label>
            </div>
            <p class="text-xs text-gray-500 mt-2">
              {{ 'menuManage.form.photoHint' | translate }}
            </p>
          </div>

          <!-- Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ -->
          <div class="flex items-center gap-3">
            <input
              type="checkbox"
              [(ngModel)]="formData.available"
              name="available"
              id="available"
              class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
            />
            <label for="available" class="text-sm font-medium text-gray-700">
              {{ 'menuManage.form.available' | translate }}
            </label>
          </div>
        </div>

        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ -->
        <div class="flex gap-3 mt-6">
          <button
            type="button"
            (click)="closeModal()"
            class="flex-1 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition font-medium"
          >
            {{ 'menuManage.form.cancel' | translate }}
          </button>
          <button
            type="submit"
            class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium"
          >
            {{ editingItem ? ('menuManage.form.save' | translate) : ('menuManage.form.add' | translate) }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾: Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° -->
  <div
    *ngIf="showRecipeModal && (warehouseItems$ | async) as warehouseItems"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    (click)="closeRecipeModal()"
  >
    <div
      class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto"
      (click)="$event.stopPropagation()"
    >
      <!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº -->
      <div class="border-b px-6 py-4 flex justify-between items-center bg-purple-50">
        <div>
          <h2 class="text-2xl font-bold text-gray-800">
            {{ 'menuManage.recipe.title' | translate }}
          </h2>
          <p class="text-sm text-gray-600 mt-1">{{ selectedMenuItem ? getLocalizedName(selectedMenuItem) : '' }}</p>
        </div>
        <button
          (click)="closeRecipeModal()"
          class="text-gray-400 hover:text-gray-600 transition"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ° -->
      <form (ngSubmit)="saveRecipe()" class="p-6">
        <div class="space-y-4">
          <!-- Ğ˜Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ñ‹ -->
          <div>
            <div class="flex justify-between items-center mb-3">
              <label class="text-lg font-semibold text-gray-800">{{ 'menuManage.recipe.ingredients' | translate }}</label>
              <button
                type="button"
                (click)="addIngredient()"
                class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg transition text-sm font-medium flex items-center gap-1"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                {{ 'menuManage.recipe.addIngredient' | translate }}
              </button>
            </div>

            <div class="space-y-3">
              <div
                *ngFor="let ingredient of recipeFormData; let i = index"
                class="flex gap-3 items-start bg-gray-50 p-3 rounded-lg"
              >
                <!-- Ğ¢Ğ¾Ğ²Ğ°Ñ€ ÑĞ¾ ÑĞºĞ»Ğ°Ğ´Ğ° -->
                <div class="flex-1">
                  <select
                    [(ngModel)]="ingredient.warehouseItemId"
                    [name]="'ingredient-item-' + i"
                    (change)="onIngredientChange(i, ingredient.warehouseItemId, warehouseItems)"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-sm"
                    required
                  >
                    <option [value]="0">{{ 'menuManage.recipe.selectProduct' | translate }}</option>
                    <option *ngFor="let warehouseItem of warehouseItems" [value]="warehouseItem.id">
                      {{ getWarehouseItemLabel(warehouseItem) }}
                    </option>
                  </select>
                </div>

                <!-- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ -->
                <div class="w-32">
                  <input
                    type="number"
                    [(ngModel)]="ingredient.quantity"
                    [name]="'ingredient-qty-' + i"
                    min="0"
                    step="0.001"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-sm"
                    [placeholder]="'menuManage.recipe.quantityPlaceholder' | translate"
                    required
                  />
                </div>

                <!-- Ğ•Ğ´Ğ¸Ğ½Ğ¸Ñ†Ğ° Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ (readonly) -->
                <div class="w-20">
                  <input
                    type="text"
                    [value]="getUnitLabel(ingredient.unit)"
                    class="w-full px-3 py-2 border border-gray-200 bg-gray-100 rounded-lg text-sm text-gray-600 text-center"
                    readonly
                  />
                </div>

                <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ -->
                <button
                  type="button"
                  (click)="removeIngredient(i)"
                  class="text-red-600 hover:text-red-800 p-2 hover:bg-red-50 rounded transition"
                  [title]="'menuManage.recipe.deleteTooltip' | translate"
                >
                  ğŸ—‘ï¸
                </button>
              </div>

              <div *ngIf="recipeFormData.length === 0" class="text-center py-6 text-gray-500">
                <p>{{ 'menuManage.recipe.empty' | translate }}</p>
              </div>
            </div>
          </div>

          <!-- ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              {{ 'menuManage.recipe.description' | translate }}
            </label>
            <textarea
              [(ngModel)]="recipeDescription"
              name="recipeDescription"
              rows="3"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none resize-none text-sm"
              [placeholder]="'menuManage.recipe.descriptionPlaceholder' | translate"
            ></textarea>
          </div>
        </div>

        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ -->
        <div class="flex gap-3 mt-6">
          <button
            type="button"
            (click)="closeRecipeModal()"
            class="flex-1 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition font-medium"
          >
            {{ 'menuManage.recipe.cancel' | translate }}
          </button>
          <button
            type="submit"
            class="flex-1 px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition font-medium"
          >
            {{ editingRecipe ? ('menuManage.recipe.saveCard' | translate) : ('menuManage.recipe.createCard' | translate) }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
