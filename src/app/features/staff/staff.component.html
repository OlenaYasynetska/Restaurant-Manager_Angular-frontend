<div class="max-w-7xl mx-auto">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ -->
  <div class="mb-6 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-800 mb-2">–ü–µ—Ä—Å–æ–Ω–∞–ª</h1>
      <p class="text-gray-600">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–æ–º —Ä–∞–±–æ—Ç—ã</p>
    </div>
    <div class="flex gap-3">
      <button
        (click)="openCreateStaffModal()"
        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition font-medium flex items-center gap-2"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
      </button>
      <button
        (click)="openCreateShiftModal()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition font-medium flex items-center gap-2"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É
      </button>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div
        *ngFor="let person of staff$ | async"
        class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition"
      >
        <div class="flex justify-between items-start mb-2">
          <div class="flex-1">
            <h3 class="font-semibold text-gray-900">{{ person.name }}</h3>
            <span [class]="'text-xs px-2 py-1 rounded-full inline-block mt-1 ' + getRoleColor(person.role)">
              {{ person.role }}
            </span>
          </div>
          <div class="flex gap-1">
            <button
              (click)="openEditStaffModal(person)"
              class="text-blue-600 hover:text-blue-800 p-1"
              title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
            >
              ‚úèÔ∏è
            </button>
            <button
              (click)="deleteStaff(person)"
              class="text-red-600 hover:text-red-800 p-1"
              title="–£–¥–∞–ª–∏—Ç—å"
            >
              üóëÔ∏è
            </button>
          </div>
        </div>
        
        <div class="text-sm text-gray-600 space-y-1">
          <div>üìû {{ person.phone }}</div>
          <div *ngIf="person.email">‚úâÔ∏è {{ person.email }}</div>
          <div class="font-semibold text-gray-800">{{ formatPrice(person.hourlyRate) }}/—á–∞—Å</div>
        </div>
        
        <div class="mt-3 flex items-center gap-2">
          <button
            (click)="toggleStaffActive(person)"
            [class]="'text-xs px-3 py-1 rounded-full transition ' +
              (person.active 
                ? 'bg-green-100 text-green-700 hover:bg-green-200' 
                : 'bg-gray-100 text-gray-600 hover:bg-gray-200')"
          >
            {{ person.active ? '‚úì –ê–∫—Ç–∏–≤–µ–Ω' : '‚úó –ù–µ–∞–∫—Ç–∏–≤–µ–Ω' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold text-gray-800">–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã</h2>
      
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div *ngIf="selectedStaffId !== 'all' && startDate && endDate" class="text-sm bg-blue-50 px-4 py-2 rounded-lg">
        <span class="text-gray-600">–ß–∞—Å–æ–≤:</span>
        <span class="font-bold text-blue-700 ml-2">{{ getTotalHours().toFixed(1) }}—á</span>
        <span class="text-gray-600 ml-4">–ö –æ–ø–ª–∞—Ç–µ:</span>
        <span class="font-bold text-green-700 ml-2">{{ formatPrice(getTotalSalary()) }}</span>
      </div>
      <div *ngIf="selectedStaffId === 'all' && startDate && endDate" class="text-sm bg-blue-50 px-4 py-2 rounded-lg">
        <span class="text-gray-600">–í—Å–µ–≥–æ —á–∞—Å–æ–≤:</span>
        <span class="font-bold text-blue-700 ml-2">{{ getTotalHours().toFixed(1) }}—á</span>
      </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="mb-4 flex gap-4 flex-wrap">
      <div class="flex-1 min-w-[200px]">
        <label class="block text-sm font-medium text-gray-700 mb-1">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
        <select
          [(ngModel)]="selectedStaffId"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
        >
          <option value="all">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
          <option *ngFor="let person of staff$ | async" [value]="person.id">
            {{ person.name }} ({{ person.role }})
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
        <input
          type="date"
          [(ngModel)]="startDate"
          class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
        <input
          type="date"
          [(ngModel)]="endDate"
          class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
        />
      </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–º–µ–Ω -->
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">–î–∞—Ç–∞</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ù–∞—á–∞–ª–æ</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ö–æ–Ω–µ—Ü</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ß–∞—Å–æ–≤</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ó–∞–º–µ—Ç–∫–∏</th>
            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let shift of getFilteredShifts(shifts$ | async)" 
              [class]="getStaffName(shift.staffId, staff$ | async) === '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' ? 'bg-red-50 hover:bg-red-100' : 'hover:bg-gray-50'">
            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
              {{ formatDate(shift.date) }}
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm">
              <ng-container *ngIf="getStaffName(shift.staffId, staff$ | async) !== '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'; else unknownStaff">
                <span class="text-gray-900 font-medium">{{ getStaffName(shift.staffId, staff$ | async) }}</span>
              </ng-container>
              <ng-template #unknownStaff>
                <span class="text-red-600 font-medium">‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ (ID: {{ shift.staffId }})</span>
              </ng-template>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm">
              <ng-container *ngIf="getStaffRole(shift.staffId, staff$ | async) as role">
                <span [class]="'px-2 py-1 rounded-full text-xs ' + getRoleColor(role)">
                  {{ role }}
                </span>
              </ng-container>
              <ng-container *ngIf="!getStaffRole(shift.staffId, staff$ | async)">
                <span class="px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-600">-</span>
              </ng-container>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">{{ shift.startTime }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">{{ shift.endTime }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm font-semibold text-blue-700">
              {{ shift.hours.toFixed(1) }}—á
            </td>
            <td class="px-4 py-3 text-sm text-gray-600">{{ shift.notes || '-' }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-center text-sm">
              <button
                (click)="openEditShiftModal(shift)"
                class="text-blue-600 hover:text-blue-800 mx-1"
                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
              >
                ‚úèÔ∏è
              </button>
              <button
                (click)="deleteShift(shift)"
                class="text-red-600 hover:text-red-800 mx-1"
                title="–£–¥–∞–ª–∏—Ç—å"
              >
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- –ï—Å–ª–∏ –Ω–µ—Ç —Å–º–µ–Ω -->
      <div
        *ngIf="getFilteredShifts(shifts$ | async).length === 0"
        class="text-center py-8 text-gray-500"
      >
        <div class="text-4xl mb-2">üìÖ</div>
        <p>–ù–µ—Ç —Å–º–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –°–æ—Ç—Ä—É–¥–Ω–∏–∫ -->
  <div
    *ngIf="showStaffModal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    (click)="closeStaffModal()"
  >
    <div
      class="bg-white rounded-lg shadow-xl max-w-lg w-full"
      (click)="$event.stopPropagation()"
    >
      <div class="border-b px-6 py-4 flex justify-between items-center">
        <h2 class="text-2xl font-bold text-gray-800">
          {{ editingStaff ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞' : '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞' }}
        </h2>
        <button (click)="closeStaffModal()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <form (ngSubmit)="saveStaff()" class="p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            –§–ò–û <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            [(ngModel)]="staffForm.name"
            name="name"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
          <select
            [(ngModel)]="staffForm.role"
            name="role"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option *ngFor="let role of roles" [value]="role.value">{{ role.label }}</option>
          </select>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input
              type="tel"
              [(ngModel)]="staffForm.phone"
              name="phone"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
              placeholder="+7 (999) 123-45-67"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input
              type="email"
              [(ngModel)]="staffForm.email"
              name="email"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
              placeholder="email@example.com"
            />
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–°—Ç–∞–≤–∫–∞ (‚Ç¨/—á–∞—Å)</label>
            <input
              type="number"
              [(ngModel)]="staffForm.hourlyRate"
              name="hourlyRate"
              min="0"
              step="0.5"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–î–∞—Ç–∞ –Ω–∞–π–º–∞</label>
            <input
              type="date"
              [(ngModel)]="staffForm.hiredDate"
              name="hiredDate"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
          </div>
        </div>

        <div class="flex items-center gap-3">
          <input
            type="checkbox"
            [(ngModel)]="staffForm.active"
            name="active"
            id="active"
            class="w-4 h-4 text-blue-600 border-gray-300 rounded"
          />
          <label for="active" class="text-sm font-medium text-gray-700">–ê–∫—Ç–∏–≤–µ–Ω</label>
        </div>

        <div class="flex gap-3 mt-6">
          <button
            type="button"
            (click)="closeStaffModal()"
            class="flex-1 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition font-medium"
          >
            –û—Ç–º–µ–Ω–∞
          </button>
          <button
            type="submit"
            class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium"
          >
            {{ editingStaff ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –°–º–µ–Ω–∞ -->
  <div
    *ngIf="showShiftModal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    (click)="closeShiftModal()"
  >
    <div
      class="bg-white rounded-lg shadow-xl max-w-lg w-full"
      (click)="$event.stopPropagation()"
    >
      <div class="border-b px-6 py-4 flex justify-between items-center">
        <h2 class="text-2xl font-bold text-gray-800">
          {{ editingShift ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–º–µ–Ω—É' : '–î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É' }}
        </h2>
        <button (click)="closeShiftModal()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <form (ngSubmit)="saveShift()" class="p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            –°–æ—Ç—Ä—É–¥–Ω–∏–∫ <span class="text-red-500">*</span>
          </label>
          <select
            [(ngModel)]="shiftForm.staffId"
            name="staffId"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option [value]="0">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>
            <option *ngFor="let person of staff$ | async" [value]="person.id">
              {{ person.name }} ({{ person.role }})
            </option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">–î–∞—Ç–∞</label>
          <input
            type="date"
            [(ngModel)]="shiftForm.date"
            name="date"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞—á–∞–ª–æ</label>
            <input
              type="time"
              [(ngModel)]="shiftForm.startTime"
              name="startTime"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–û–∫–æ–Ω—á–∞–Ω–∏–µ</label>
            <input
              type="time"
              [(ngModel)]="shiftForm.endTime"
              name="endTime"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">–ó–∞–º–µ—Ç–∫–∏</label>
          <textarea
            [(ngModel)]="shiftForm.notes"
            name="notes"
            rows="2"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none"
            placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."
          ></textarea>
        </div>

        <div class="flex gap-3 mt-6">
          <button
            type="button"
            (click)="closeShiftModal()"
            class="flex-1 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition font-medium"
          >
            –û—Ç–º–µ–Ω–∞
          </button>
          <button
            type="submit"
            class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium"
          >
            {{ editingShift ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
